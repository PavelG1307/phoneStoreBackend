# Телеграм супер бот
Бот разбит на 3 приложения:
- Бот: отвечает за обработку сообщений и команд пользователя
- Уведомитель: отвечает за извлечение задач из очереди и отправке уведомлений пользователям
- Веб приложение: отвечает за валидацию запросов из Telegram WebApp (MiniApp), управление метриками

## Содержание
- [Конфигурация](#конфигурация)
- [Установка зависимостей](#установка-зависимостей)
- [Установка хука на pre-commit](#установка-хука-pre-commit)
- [Кодогенератор](#кодогенератор)
- [Линтер](#линтер)
- [Запуск](#запуск)


## Конфигурация
### С помощью файла .env
Скопируйте `.env.example` командой
```sh
cp .env.example .env
```
Измените значения переменных файла `.env` на свои

### С помощью .env переменных
Самостоятельно укажите значения env переменных, указанных в файле `.env.example`


## Установка зависимостей
> При запуске бота через Docker, установка Go и зависимостей не требуется
Для стабильной работы бота требуется Go 1.21. Для установки зависимостей, выполните команду:
```sh
go mod download
```


## Установка хука на pre-commit
Для добавления хука на pre-commit необходимо выполнить команду

```sh
make setup-tools
```
Перед созданием коммитов будет запускаться линтер и проверять код на не соответствие стандартам кода. В случае успешной проверки, создастся коммит


## Кодогенератор
Генерация кода клиентов и сервера происходит с помощью пакета [oapi-codegen](https://github.com/deepmap/oapi-codegen).
При внесении изменений, необходимо генерировать новый код клиента и сервера
Генерация кода производится в Docker, описание команд можно посмотреть в файле `Dockerfile.gen`
```sh
make generate-openapi
```


## Линтер
Линтер запускается в Docker. Для запуска линтера используйте команду
```sh
make lint
```


## Запуск
### Запуск уведомителя
```sh
make run-notifier
```

### Запуск бота
```sh
make run-bot
```

### Запуск API для WebApp
```sh
make run-webapp
```
